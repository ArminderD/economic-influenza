---
title: "scratch"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls(all.names = TRUE))
library(mc2d)
```

Updating costs to US 2018$ values using the medical cost component of the Consumer Price Index
- unadjusted index Dec 2009 = 379.516
- unadjusted index Jan 2018 = 513.135

```{r}
cpi <- ((513.135 - 379.516)/379.516) + 1
```


# Variables

```{r}
# risk.group
highrisk0_19 <- 0.064  # meltzer 1999
highrisk0_4 <- 0.052  # molinari 2007
highrisk5_17 <- 0.106  # molinari 2007
highrisk20_64 <- 0.144  # meltzer 1999
highrisk65 <- 0.512  # molinari 2007
```

```{r}
# population = 3406876
# 0-4 = 223608 (0.0656)
# 5-19 = 639661 (0.187)
# 20-64 = 2235049 (0.656)
# 65+ = 308558 (0.0905)
```

# Health outcome probabilities

```{r}
# Health outcome probability, 0-4, high risk
set.seed(1000)
prob.outpatient = mean(runif(10000, min = 0.8257, max = 0.9595))
prob.hospitalization = mean(runif(10000, min = 0.006, max = 0.02143))
prob.death = mean(rtriang(10000, min = 0.00036, mode = 0.001, max = 0.01821))
rest = 1-(prob.death + prob.hospitalization + prob.outpatient)  
```

# 0-4 yrs, HIGH risk
0-4 years = 223608 (0.0656)

```{r}
children.high.risk <- function(AR, vax.comp, tot.pop, totalpopulation, num.cases, case.after.vax){
  risk.group = highrisk0_19
  subpop.ar = num.cases * risk.group
  
  # Health outcome probability, 0-4, high risk
  set.seed(1000)
  prob.outpatient = mean(runif(10000, min = 0.8257, max = 0.9595))
  prob.hospitalization = mean(runif(10000, min = 0.006, max = 0.02143))
  prob.death = mean(rtriang(10000, min = 0.00036, mode = 0.001, max = 0.01821))
  rest = 1-(prob.death + prob.hospitalization + prob.outpatient)  
  
  # Number of each health outcome, 0-4 yrs, high risk
  num.outpatient = prob.outpatient * subpop.ar
  num.hospitalization = prob.hospitalization * subpop.ar
  num.death = prob.death * subpop.ar
  num.rest = rest * subpop.ar
  num.case.ch = num.outpatient + num.hospitalization + num.death + num.rest
  
  ## Cost of each health outcome, 0-4 yrs, high risk
  # cost.death.ch =  1487872 * cpi 
  # cost.hospitalization.ch = 31894 * cpi
  # cost.outpatient.ch = 948 * cpi
  # cost.rest.ch = 116.5 * cpi
  
  # Total cost, 0-4 yrs, high risk
  tot.cost.death.ch = cost.death.ch * num.death
  tot.cost.hospitalization.ch = cost.hospitalization.ch * num.hospitalization
  tot.cost.outpatient.ch = cost.outpatient.ch * num.outpatient
  tot.cost.rest.ch = cost.rest.ch * num.rest
  tot.cost.ch = tot.cost.death.ch + tot.cost.hospitalization.ch + tot.cost.outpatient.ch + tot.cost.rest.ch
  tot.cost.ch
  
  # Vaccination, 0-4 yrs, high risk
  # vax.cost = 28.62
  vaccination.cost = vax.cost * (vax.comp) * tot.pop * risk.group
  tot.cost.ch.vax = vaccination.cost
  tot.cost.ch.vax
  
  # Non-vaccinated, 0-4 yrs, high risk
  subpop.ar.nonvax = case.after.vax * risk.group
  num.outpatient.nonvax = prob.outpatient * subpop.ar.nonvax
  num.hospitalization.nonvax = prob.hospitalization * subpop.ar.nonvax
  num.death.nonvax = prob.death * subpop.ar.nonvax
  num.rest.nonvax = rest * subpop.ar.nonvax
  num.case.ch.nonvax = num.outpatient.nonvax + num.hospitalization.nonvax + num.death.nonvax + num.rest.nonvax
  
  # Total cost, 0-4 yrs, high risk, non-vax
  cost.death.ch.nonvax = cost.death.ch * num.death.nonvax
  cost.hospitalization.ch.nonvax = cost.hospitalization.ch * num.hospitalization.nonvax
  cost.outpatient.ch.nonvax = cost.outpatient.ch * num.outpatient.nonvax
  cost.rest.ch.nonvax = cost.rest.ch * num.rest.nonvax
  tot.cost.ch.nonvax = cost.death.ch.nonvax + cost.hospitalization.ch.nonvax + cost.outpatient.ch.nonvax + cost.rest.ch.nonvax
  tot.cost.ch.nonvax
  
  
  res <- c(tot.cost.ch, tot.cost.ch.vax + tot.cost.ch.nonvax, tot.cost.ch - (tot.cost.ch.vax + tot.cost.ch.nonvax),
           (tot.cost.ch - (tot.cost.ch.vax + tot.cost.ch.nonvax))/(totalpopulation * risk.group),
           (tot.cost.ch - (tot.cost.ch.vax + tot.cost.ch.nonvax))/(vax.comp * tot.pop * risk.group),
           (tot.cost.ch - (tot.cost.ch.vax + tot.cost.ch.nonvax))/(vax.comp * tot.pop * risk.group * vax.cost),
           num.case.ch, num.case.ch.nonvax, num.death, num.death/(totalpopulation * risk.group))
  return(res)
}

```

# 0-4 yrs, low risk

```{r}

```

```{r}

```


# 5-19 yrs, HIGH risk
# 5-19 yrs, low risk

# 20-64 yrs, HIGH risk
# 20-64 yrs, low risk

# 65+ yrs, HIGH risk
# 65+ yrs, low risk


